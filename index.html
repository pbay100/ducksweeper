<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Duck Dodge — Eggs!</title>
<style>
  html,body {height:100%;margin:0;background:#0e1a2b;color:#e9eef7;font-family:system-ui,Arial}
  .wrap {display:grid;place-items:center;height:100%}
  canvas {background:linear-gradient(#77c0ff,#cbe9ff 60%, #5fb057 60%, #4aa547 100%);
          border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35)}
  .hud {position:fixed; top:12px; left:50%; transform:translateX(-50%);
        background:#0b1322cc; border:1px solid #2e3d58; padding:6px 10px; border-radius:10px;
        font-variant-numeric:tabular-nums}
  .hint {position:fixed; bottom:14px; left:50%; transform:translateX(-50%); 
         background:#0b1322cc; border:1px solid #2e3d58; padding:6px 10px; border-radius:10px; font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <canvas id="game" width="520" height="360"></canvas>
</div>
<div class="hud">Score: <span id="sc">0</span> · Misses: <span id="ms">0</span></div>
<div class="hint">← → to move · R to restart</div>

<script>
const c = document.getElementById('game');
const ctx = c.getContext('2d');
const W=c.width, H=c.height;

const duck = { x: W/2, y: H-52, w: 46, h: 34, speed: 240, sadUntil: 0 };
let eggs = [];
let last = 0, acc = 0;
let score = 0, misses = 0, running = true;
const scEl = document.getElementById('sc'), msEl = document.getElementById('ms');

const keys = {};
addEventListener('keydown', e => { keys[e.key] = true; if (e.key.toLowerCase()==='r') reset(); });
addEventListener('keyup',   e => { keys[e.key] = false; });

function reset(){
  eggs = []; score = 0; misses = 0; running = true; duck.sadUntil = 0;
  scEl.textContent = score; msEl.textContent = misses;
}

function spawnEgg(){
  const x = 20 + Math.random()*(W-40);
  eggs.push({ x, y:-20, vy: 90+Math.random()*110, r:10, state:'fall' }); // state: fall|broken
}

function update(dt){
  if (!running) return;
  // duck move
  if (keys['ArrowLeft']) duck.x -= duck.speed*dt;
  if (keys['ArrowRight']) duck.x += duck.speed*dt;
  duck.x = Math.max(duck.w/2, Math.min(W-duck.w/2, duck.x));
  // spawn eggs
  if (Math.random() < 0.02 + score*0.0005) spawnEgg();
  // eggs physics
  for (const e of eggs){
    if (e.state==='fall'){
      e.y += e.vy*dt;
      // collide with duck (AABB-circle quick check)
      const dx = Math.max(Math.abs(e.x - duck.x) - duck.w/2, 0);
      const dy = Math.max(Math.abs(e.y - duck.y) - duck.h/2, 0);
      const dist2 = dx*dx + dy*dy;
      if (dist2 <= e.r*e.r){
        e.state='broken'; e.vy=0; // break egg
        duck.sadUntil = performance.now()+900; // duck sad for 0.9s
        score = Math.max(0, score-1);
        scEl.textContent = score;
      }
    }
  }
  // remove / count misses
  eggs = eggs.filter(e=>{
    if (e.y > H+30 && e.state==='fall'){ misses++; msEl.textContent=misses; return false; }
    return true;
  });
}

function draw(){
  ctx.clearRect(0,0,W,H);
  drawDuck();
  drawEggs();
}

function drawDuck(){
  const sad = performance.now() < duck.sadUntil;
  // body
  ctx.save();
  ctx.translate(duck.x, duck.y);
  // belly
  ctx.fillStyle = '#ffd54a';
  roundRect(-duck.w/2, -duck.h/2, duck.w, duck.h, 10);
  ctx.fill();
  // head
  ctx.beginPath();
  ctx.arc(duck.w*0.22, -duck.h*0.25, 12, 0, Math.PI*2);
  ctx.fillStyle = '#ffe071'; ctx.fill();
  // beak
  ctx.fillStyle = '#ff9f43';
  ctx.fillRect(duck.w*0.32, -duck.h*0.28, 14, 7);
  // eye
  ctx.fillStyle = '#0b1322';
  if (sad){
    // sad eye (angled line)
    ctx.save(); ctx.translate(duck.w*0.18, -duck.h*0.30); ctx.rotate(-0.6);
    ctx.fillRect(0,0,10,2); ctx.restore();
  } else {
    ctx.beginPath(); ctx.arc(duck.w*0.18, -duck.h*0.30, 2.2, 0, Math.PI*2); ctx.fill();
  }
  // tear when sad
  if (sad){ ctx.fillStyle='#7ad3ff'; ctx.beginPath(); ctx.arc(duck.w*0.16, -duck.h*0.18, 3, 0, Math.PI*2); ctx.fill(); }
  ctx.restore();
}

function drawEggs(){
  for (const e of eggs){
    ctx.save();
    ctx.translate(e.x, e.y);
    if (e.state==='fall'){
      // whole egg
      ctx.fillStyle='#fffaf0'; drawEggShape(ctx,0,0,12,16); ctx.fill();
      ctx.strokeStyle='#e9e2d4'; ctx.stroke();
    } else {
      // broken egg: two halves + goo
      ctx.fillStyle='#fffaf0';
      drawEggShape(ctx,-8,0,8,10); ctx.fill();
      drawEggShape(ctx, 8,0,8,10); ctx.fill();
      ctx.fillStyle='#ffe17a';
      ctx.beginPath(); ctx.arc(0,8,6,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();
  }
}

function drawEggShape(ctx,x,y,rx,ry){
  ctx.beginPath();
  ctx.ellipse(x,y,rx,ry,0,0,Math.PI*2);
}

function roundRect(x,y,w,h,r){ ctx.beginPath();
  ctx.moveTo(x+r,y); ctx.lineTo(x+w-r,y); ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r); ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h); ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r); ctx.quadraticCurveTo(x,y,x+r,y); }

function loop(ts){
  if (!last) last = ts;
  const dt = Math.min((ts-last)/1000, 0.033);
  last = ts; acc += dt;
  while (acc > 0) { update(1/60); acc -= 1/60; }
  draw();
  requestAnimationFrame(loop);
}
reset(); requestAnimationFrame(loop);
</script>
</body>
</html>
